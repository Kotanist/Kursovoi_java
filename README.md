# 📚 Информационная система "Книжный магазин"

Веб-приложение для управления книжным магазином на базе Java EE и PostgreSQL с системой аутентификации и разграничением прав доступа.

## 🎯 Описание проекта

Полнофункциональная информационная система для управления книжным магазином, реализованная в рамках курсового проекта по Java EE.

### Основной функционал:
- **📚 Книги** - каталог книг с информацией об авторе, издательстве, серии, годе издания и цене
- **👥 Покупатели** - база данных покупателей с контактной информацией
- **👔 Продавцы** - учет персонала магазина
- **🛒 Заказы** - обработка заказов с привязкой к книгам, покупателям и продавцам
- **🔐 Аутентификация** - система входа с регистрацией пользователей
- **🛡️ Разграничение прав** - разные уровни доступа для администраторов и пользователей

## 🛠 Технологии

- **Java 17**
- **Jakarta EE / Servlet API 5.0**
- **Hibernate 6.5.2** (JPA)
- **PostgreSQL** - основная БД с кодировкой UTF-8
- **BCrypt** - хеширование паролей
- **H2** - для тестирования
- **JSP/JSTL 3.0** - представления
- **JUnit 5 + Mockito** - тестирование
- **Maven 3.9+** - сборка проекта
- **Jetty 11** - веб-сервер для разработки

## 📋 Требования

- **JDK 17** или выше
- **PostgreSQL 12+**
- **Maven 3.6+**

## 🚀 Быстрый старт

### 1. Клонирование репозитория

```bash
git clone <repository-url>
cd books_java
```

### 2. Настройка базы данных

**Создание базы данных с UTF-8 кодировкой:**

```sql
-- В консоли PostgreSQL (psql -U postgres)
DROP DATABASE IF EXISTS bookstore_utf8;
CREATE DATABASE bookstore_utf8 
    WITH OWNER = postgres 
    ENCODING = 'UTF8' 
    LC_COLLATE = 'C' 
    LC_CTYPE = 'C' 
    TEMPLATE = template0;
```

**Инициализация таблиц и данных:**

```bash
# Windows PowerShell
$env:PGPASSWORD="ВАШ_ПАРОЛЬ"
psql -U postgres -d bookstore_utf8 -f database.sql
```

```bash
# Linux/Mac
export PGPASSWORD="ВАШ_ПАРОЛЬ"
psql -U postgres -d bookstore_utf8 -f database.sql
```

### 3. Настройка подключения к БД

⚠️ **ВАЖНО:** Отредактируйте `src/main/resources/META-INF/persistence.xml`:

Найдите строку с `YOUR_PASSWORD_HERE` и замените на ваш реальный пароль PostgreSQL:

```xml
<property name="jakarta.persistence.jdbc.url" 
          value="jdbc:postgresql://localhost:5432/bookstore_utf8?useUnicode=true&amp;characterEncoding=UTF-8"/>
<property name="jakarta.persistence.jdbc.user" value="postgres"/>
<property name="jakarta.persistence.jdbc.password" value="YOUR_PASSWORD_HERE"/>
```

**Замените `YOUR_PASSWORD_HERE` на ваш реальный пароль!**

> 🔒 **Примечание:** Файл в репозитории специально содержит placeholder вместо реального пароля для безопасности.

### 4. Запуск приложения

```bash
# Сборка и запуск через Maven
mvn clean jetty:run
```

**Приложение будет доступно по адресу:** `http://localhost:8081`

## 🔐 Вход в систему

### Администратор по умолчанию:
- **Логин:** `admin`
- **Пароль:** `admin123`

### Регистрация новых пользователей:
1. Откройте http://localhost:8081
2. Нажмите "Зарегистрироваться"
3. Заполните форму регистрации
4. Новые пользователи получают роль USER (ограниченный доступ)

## 👑 Разграничение прав доступа

### Администратор (ADMIN):
- ✅ Полный CRUD для книг (добавление, редактирование, удаление)
- ✅ Полный доступ к базе покупателей
- ✅ Полный доступ к базе продавцов
- ✅ Полный доступ к управлению заказами

### Обычный пользователь (USER):
- ✅ Просмотр каталога книг (только чтение)
- ❌ Нет доступа к редактированию книг
- ❌ Нет доступа к базе покупателей
- ❌ Нет доступа к базе продавцов
- ❌ Нет доступа к заказам

## 📂 Структура проекта

```
books_java/
├── src/
│   ├── main/
│   │   ├── java/com/bookstore/
│   │   │   ├── model/          # Модели данных (Entity)
│   │   │   │   ├── Book.java
│   │   │   │   ├── Customer.java
│   │   │   │   ├── Sale.java
│   │   │   │   ├── Order.java
│   │   │   │   └── User.java   # Модель пользователя
│   │   │   ├── repository/     # Слой работы с БД (DAO)
│   │   │   ├── service/        # Бизнес-логика
│   │   │   │   └── UserService.java  # Сервис аутентификации
│   │   │   ├── controller/     # Servlets (контроллеры)
│   │   │   │   ├── BookServlet.java
│   │   │   │   ├── CustomerServlet.java
│   │   │   │   ├── SaleServlet.java
│   │   │   │   ├── OrderServlet.java
│   │   │   │   └── AuthServlet.java  # Контроллер аутентификации
│   │   │   ├── filter/         # Фильтры безопасности
│   │   │   │   ├── AuthenticationFilter.java
│   │   │   │   └── CharacterEncodingFilter.java
│   │   │   └── util/           # Утилиты (EMF)
│   │   ├── resources/
│   │   │   └── META-INF/
│   │   │       └── persistence.xml
│   │   └── webapp/
│   │       ├── WEB-INF/
│   │       │   ├── views/
│   │       │   │   ├── auth/         # Страницы аутентификации
│   │       │   │   ├── books/        # Управление книгами
│   │       │   │   ├── customers/    # Управление покупателями
│   │       │   │   ├── sales/        # Управление продавцами
│   │       │   │   └── orders/       # Управление заказами
│   │       │   └── web.xml
│   │       └── index.jsp
│   └── test/
│       └── java/com/bookstore/
│           ├── service/        # Модульные тесты
│           ├── controller/     # Интеграционные тесты
│           └── repository/     # Интеграционные тесты репозиториев
├── database.sql                # SQL скрипт БД
├── pom.xml                     # Maven конфигурация
├── run.bat                     # Скрипт запуска для Windows
└── README.md
```

## 🧪 Запуск тестов

```bash
# Запуск всех тестов
mvn test

# Запуск с детальным выводом
mvn test -X
```

### Реализованные тесты:
- ✅ Модульные тесты для `BookService`
- ✅ Модульные тесты для `CustomerService`
- ✅ Модульные тесты для `SaleService`
- ✅ Интеграционные тесты для `BookServlet`
- ✅ Интеграционные тесты для `BookRepository`

## 📱 Функционал приложения

### 🔐 Система аутентификации
- ✅ Вход в систему с валидацией
- ✅ Регистрация новых пользователей
- ✅ Хеширование паролей с использованием BCrypt
- ✅ Управление сессиями (30 минут)
- ✅ Защита от несанкционированного доступа
- ✅ Автоматический выход при истечении сессии

### 📚 Управление книгами
- ✅ Просмотр каталога книг (все пользователи)
- ✅ Добавление новой книги (только ADMIN)
- ✅ Редактирование информации о книге (только ADMIN)
- ✅ Удаление книги (только ADMIN)
- ✅ Поиск и фильтрация

### 👥 Управление покупателями (только ADMIN)
- ✅ Просмотр базы покупателей
- ✅ Добавление нового покупателя
- ✅ Редактирование данных покупателя
- ✅ Удаление покупателя

### 👔 Управление продавцами (только ADMIN)
- ✅ Просмотр списка персонала
- ✅ Добавление нового продавца
- ✅ Редактирование информации о продавце
- ✅ Удаление продавца

### 🛒 Управление заказами (только ADMIN)
- ✅ Просмотр всех заказов
- ✅ Создание нового заказа
- ✅ Редактирование заказа
- ✅ Удаление заказа
- ✅ Автоматический расчет общей суммы

## 🛡️ Безопасность

### Многоуровневая защита:

1. **Уровень фильтров:**
   - `AuthenticationFilter` - проверка аутентификации для всех запросов
   - `CharacterEncodingFilter` - корректная обработка UTF-8

2. **Уровень контроллеров:**
   - Проверка прав перед выполнением операций
   - Возврат HTTP 403 при недостаточных правах

3. **Уровень интерфейса:**
   - Скрытие недоступных функций для пользователей
   - Визуальная индикация уровня доступа

4. **Безопасность паролей:**
   - Хеширование с использованием BCrypt
   - Strength: 12 rounds (надежная защита)

## 🎨 Особенности UI

- ✨ Современный адаптивный дизайн
- 🎨 Градиентные цветовые схемы
- 🔄 Плавные анимации и переходы
- 📱 Отзывчивый интерфейс
- 🌈 Интуитивная навигация
- ✅ Удобные формы с валидацией
- 🔐 Красивые страницы входа и регистрации

## 📝 Модель данных

### User (Пользователь) 🆕
- `id` - уникальный идентификатор
- `username` - имя пользователя (уникальное)
- `email` - электронная почта (уникальная)
- `password` - хешированный пароль (BCrypt)
- `role` - роль (ADMIN/USER)
- `isActive` - статус активности
- `createdAt` - дата создания

### Book (Книга)
- `id` - уникальный идентификатор
- `title` - название книги
- `author` - автор
- `publishing` - издательство
- `seriya` - серия
- `year` - год издания
- `price` - цена

### Customer (Покупатель)
- `id` - уникальный идентификатор
- `firstName` - имя
- `lastName` - фамилия
- `email` - электронная почта
- `phone` - телефон

### Sale (Продавец)
- `id` - уникальный идентификатор
- `firstName` - имя
- `lastName` - фамилия
- `position` - должность
- `employmentDate` - дата приема на работу
- `dateBirth` - дата рождения
- `email` - электронная почта

### Order (Заказ)
- `id` - уникальный идентификатор
- `book` - ссылка на книгу (FK)
- `customer` - ссылка на покупателя (FK)
- `sale` - ссылка на продавца (FK)
- `dateInput` - дата оформления
- `dateOutput` - дата выдачи
- `quantity` - количество
- `totalSum` - общая сумма

## 🔧 Устранение неполадок

### Проблемы с кодировкой
Если кириллица отображается некорректно:
1. Убедитесь, что БД создана с кодировкой UTF-8
2. Проверьте настройки в `persistence.xml`
3. Используйте базу данных `bookstore_utf8`

### Ошибка подключения к БД
1. Убедитесь, что PostgreSQL запущен
2. Проверьте пароль в `persistence.xml`
3. Проверьте, что база данных `bookstore_utf8` существует

### Порт 8081 занят
```bash
# Найти процесс
netstat -ano | findstr :8081

# Завершить процесс (Windows)
taskkill /F /PID <PID>
```

## 📖 Использование

1. **Запустите приложение:** `mvn jetty:run`
2. **Откройте браузер:** http://localhost:8081
3. **Войдите как администратор:** admin / admin123
4. **Или зарегистрируйте нового пользователя**

## 👨‍💻 Разработка

### Требования к курсовому проекту:
✅ Java EE веб-приложение  
✅ PostgreSQL база данных  
✅ Главная страница с навигацией  
✅ CRUD операции для всех моделей  
✅ Модульные тесты  
✅ Интеграционные тесты  
✅ Аутентификация пользователей  
✅ Защита веб-запросов  
✅ Безопасность на уровне методов  
✅ Разграничение прав доступа  

## 📄 Лицензия

Учебный проект - Курсовая работа по дисциплине Java EE

## 📧 Контакты

Для вопросов и предложений создайте Issue в репозитории. 